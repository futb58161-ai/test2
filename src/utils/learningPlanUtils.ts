import { LearningPlan, MonthlyPlan } from '../types/types';

export const getDefaultLearningPlan = (): LearningPlan => ({
  title: "Ayoub's Intensive Plan: A2 ‚Üí B2",
  period: "August‚ÄìDecember 2025 | Target: B2 by Dec 12",
  months: [
    {
      month: "August 2025",
      level: "Phase 1: B1 Foundation (Week 1-4)",
      description: "üéØ GOAL: Solid A2 review + B1 grammar foundation | 4-5h daily | 25 words/week",
      grammar: [
        { id: "aug-g1", topic: "Week 1: Perfekt vs. Pr√§teritum (Netzwerk B1 Kap. 1-2)", completed: false },
        { id: "aug-g2", topic: "Week 2: Dativ/Akkusativ + Wechselpr√§positionen", completed: false },
        { id: "aug-g3", topic: "Week 3: Modalverben (sollen, m√ºssen, d√ºrfen)", completed: false },
        { id: "aug-g4", topic: "Week 4: Konjunktionen (weil, dass, wenn, obwohl)", completed: false },
        { id: "aug-g5", topic: "Daily: Adjektivdeklination (bestimmt/unbestimmt)", completed: false }
      ],
      vocabulary: [
        { id: "aug-v1", topic: "Week 1: Familie & Beziehungen (25 W√∂rter)", targetWords: 25, learnedWords: 0 },
        { id: "aug-v2", topic: "Week 2: Arbeit & Beruf (25 W√∂rter)", targetWords: 25, learnedWords: 0 },
        { id: "aug-v3", topic: "Week 3: Gesundheit & K√∂rper (25 W√∂rter)", targetWords: 25, learnedWords: 0 },
        { id: "aug-v4", topic: "Week 4: Wohnen & Leben (25 W√∂rter)", targetWords: 25, learnedWords: 0 }
      ],
      listening: [
        { id: "aug-l1", goal: "Easy German Videos (B1 level)", target: 20, completed: 0 },
        { id: "aug-l2", goal: "Deutsche Welle Langsam gesprochene Nachrichten", target: 28, completed: 0 },
        { id: "aug-l3", goal: "Netzwerk B1 Audio-√úbungen", target: 15, completed: 0 }
      ],
      writing: [
        { id: "aug-w1", task: "Pers√∂nliche E-Mails (100-120 W√∂rter)", frequency: "2x pro Woche", completed: 0, target: 8 },
        { id: "aug-w2", task: "Tagebuch schreiben (80-100 W√∂rter)", frequency: "t√§glich", completed: 0, target: 31 },
        { id: "aug-w3", task: "Formelle Briefe √ºben", frequency: "1x pro Woche", completed: 0, target: 4 }
      ],
      speaking: [
        { id: "aug-s1", goal: "Gespr√§che mit Lehrer/Partner (30 min)", frequency: "3x pro Woche", completed: 0, target: 12 },
        { id: "aug-s2", goal: "Selbstgespr√§che/Monolog (10 min)", frequency: "t√§glich", completed: 0, target: 31 },
        { id: "aug-s3", goal: "Shadowing Easy German Videos", frequency: "t√§glich", completed: 0, target: 31 }
      ]
    },
    {
      month: "September 2025",
      level: "Phase 1: B1 Intensive (Week 5-8)",
      description: "üöÄ GOAL: B1 mastery + complex structures | 4-5h daily | 30 words/week",
      grammar: [
        { id: "sep-g1", topic: "Week 1: Konjunktiv II (w√ºrde, h√§tte, w√§re)", completed: false },
        { id: "sep-g2", topic: "Week 2: Passiv (Pr√§sens, Pr√§teritum, Perfekt)", completed: false },
        { id: "sep-g3", topic: "Week 3: Relativs√§tze (Nominativ, Akkusativ, Dativ)", completed: false },
        { id: "sep-g4", topic: "Week 4: Indirekte Rede + Temporale Nebens√§tze", completed: false },
        { id: "sep-g5", topic: "Daily: Wiederholung + B1 Pr√ºfungsgrammatik", completed: false }
      ],
      vocabulary: [
        { id: "sep-v1", topic: "Week 1: Umwelt & Natur (30 W√∂rter)", targetWords: 30, learnedWords: 0 },
        { id: "sep-v2", topic: "Week 2: Medien & Technologie (30 W√∂rter)", targetWords: 30, learnedWords: 0 },
        { id: "sep-v3", topic: "Week 3: Kultur & Freizeit (30 W√∂rter)", targetWords: 30, learnedWords: 0 },
        { id: "sep-v4", topic: "Week 4: Reisen & Verkehr (30 W√∂rter)", targetWords: 30, learnedWords: 0 }
      ],
      listening: [
        { id: "sep-l1", goal: "Easy German Videos (komplexere Themen)", target: 25, completed: 0 },
        { id: "sep-l2", goal: "Deutsch lernen mit Jenny (B1)", target: 15, completed: 0 },
        { id: "sep-l3", goal: "Slow German Podcast", target: 12, completed: 0 },
        { id: "sep-l4", goal: "B1 Pr√ºfungsh√∂r√ºbungen", target: 10, completed: 0 }
      ],
      writing: [
        { id: "sep-w1", task: "Formelle Briefe (150-180 W√∂rter)", frequency: "2x pro Woche", completed: 0, target: 8 },
        { id: "sep-w2", task: "Meinungs√§u√üerung/Argumentation", frequency: "2x pro Woche", completed: 0, target: 8 },
        { id: "sep-w3", task: "B1 Pr√ºfungsschreiben √ºben", frequency: "1x pro Woche", completed: 0, target: 4 }
      ],
      speaking: [
        { id: "sep-s1", goal: "Diskussionen f√ºhren (45 min)", frequency: "3x pro Woche", completed: 0, target: 12 },
        { id: "sep-s2", goal: "Pr√§sentationen (10 min)", frequency: "2x pro Woche", completed: 0, target: 8 },
        { id: "sep-s3", goal: "B1 Pr√ºfungssimulation", frequency: "1x pro Woche", completed: 0, target: 4 }
      ]
    },
    {
      month: "October 2025",
      level: "Phase 1: B1 Perfection + B2 Start (Week 9-13)",
      description: "üéØ GOAL: B1 certification ready + B2 introduction | 5h daily | 35 words/week",
      grammar: [
        { id: "oct-g1", topic: "Week 1: B1 Mock Exam + Fehleranalyse", completed: false },
        { id: "oct-g2", topic: "Week 2: Erweiterte Konjunktiv II + Partizipien", completed: false },
        { id: "oct-g3", topic: "Week 3: Nominalisierung (Netzwerk B2 Kap. 1)", completed: false },
        { id: "oct-g4", topic: "Week 4: Kausale/finale Nebens√§tze (B2 Start)", completed: false },
        { id: "oct-g5", topic: "Week 5: Subjektive Modalverben (m√ºssen/k√∂nnen)", completed: false }
      ],
      vocabulary: [
        { id: "oct-v1", topic: "Week 1-2: B1 Pr√ºfungswortschatz (70 W√∂rter)", targetWords: 70, learnedWords: 0 },
        { id: "oct-v2", topic: "Week 3: Politik & Gesellschaft (35 W√∂rter)", targetWords: 35, learnedWords: 0 },
        { id: "oct-v3", topic: "Week 4: Wissenschaft & Forschung (35 W√∂rter)", targetWords: 35, learnedWords: 0 },
        { id: "oct-v4", topic: "Week 5: Wirtschaft & Finanzen (35 W√∂rter)", targetWords: 35, learnedWords: 0 }
      ],
      listening: [
        { id: "oct-l1", goal: "B1 Pr√ºfungsh√∂r√ºbungen (intensiv)", target: 15, completed: 0 },
        { id: "oct-l2", goal: "Tagesschau (langsam)", target: 20, completed: 0 },
        { id: "oct-l3", goal: "Deutsche Filme mit Untertiteln", target: 6, completed: 0 },
        { id: "oct-l4", goal: "Easy German (B2 Themen)", target: 15, completed: 0 }
      ],
      writing: [
        { id: "oct-w1", task: "B1 Pr√ºfungsschreiben (200 W√∂rter)", frequency: "3x pro Woche", completed: 0, target: 15 },
        { id: "oct-w2", task: "Argumentative Texte (B2 Vorbereitung)", frequency: "2x pro Woche", completed: 0, target: 10 },
        { id: "oct-w3", task: "Zusammenfassungen schreiben", frequency: "2x pro Woche", completed: 0, target: 10 }
      ],
      speaking: [
        { id: "oct-s1", goal: "B1 Pr√ºfungssimulation (komplett)", frequency: "2x pro Woche", completed: 0, target: 10 },
        { id: "oct-s2", goal: "Komplexe Diskussionen (60 min)", frequency: "3x pro Woche", completed: 0, target: 15 },
        { id: "oct-s3", goal: "Spontane Gespr√§che/Rollenspiele", frequency: "t√§glich", completed: 0, target: 31 }
      ]
    },
    {
      month: "November 2025",
      level: "Phase 2: B2 Intensive (Week 14-17)",
      description: "üöÄ GOAL: B2 core mastery + complex structures | 5h daily | 40 words/week",
      grammar: [
        { id: "nov-g1", topic: "Week 1: Erweiterte Relativs√§tze (Netzwerk B2 Kap. 2-3)", completed: false },
        { id: "nov-g2", topic: "Week 2: Irreale Bedingungss√§tze (wenn/falls)", completed: false },
        { id: "nov-g3", topic: "Week 3: Funktionsverbgef√ºge + Nominalisierung", completed: false },
        { id: "nov-g4", topic: "Week 4: Textverkn√ºpfung + Stilistische Varianten", completed: false },
        { id: "nov-g5", topic: "Daily: B2 Grammatik-Intensivtraining", completed: false }
      ],
      vocabulary: [
        { id: "nov-v1", topic: "Week 1: Abstrakte Begriffe (40 W√∂rter)", targetWords: 40, learnedWords: 0 },
        { id: "nov-v2", topic: "Week 2: Idiome & Redewendungen (40 W√∂rter)", targetWords: 40, learnedWords: 0 },
        { id: "nov-v3", topic: "Week 3: Fachsprache & Wissenschaft (40 W√∂rter)", targetWords: 40, learnedWords: 0 },
        { id: "nov-v4", topic: "Week 4: Medien & Kommunikation (40 W√∂rter)", targetWords: 40, learnedWords: 0 }
      ],
      listening: [
        { id: "nov-l1", goal: "Deutsche Dokumentationen (Arte, ZDF)", target: 12, completed: 0 },
        { id: "nov-l2", goal: "Radio-Interviews & Nachrichten", target: 20, completed: 0 },
        { id: "nov-l3", goal: "Easy German (B2 komplexe Themen)", target: 20, completed: 0 },
        { id: "nov-l4", goal: "B2 Pr√ºfungsh√∂r√ºbungen", target: 15, completed: 0 }
      ],
      writing: [
        { id: "nov-w1", task: "Er√∂rterungen (250-300 W√∂rter)", frequency: "2x pro Woche", completed: 0, target: 8 },
        { id: "nov-w2", task: "Berichte & Analysen schreiben", frequency: "2x pro Woche", completed: 0, target: 8 },
        { id: "nov-w3", task: "B2 Pr√ºfungsschreiben √ºben", frequency: "2x pro Woche", completed: 0, target: 8 }
      ],
      speaking: [
        { id: "nov-s1", goal: "Pr√§sentationen (15-20 min)", frequency: "2x pro Woche", completed: 0, target: 8 },
        { id: "nov-s2", goal: "Komplexe Rollenspiele & Debatten", frequency: "3x pro Woche", completed: 0, target: 12 },
        { id: "nov-s3", goal: "B2 Pr√ºfungssimulation", frequency: "2x pro Woche", completed: 0, target: 8 }
      ]
    },
    {
      month: "December 2025",
      level: "Phase 2: B2 Mastery + Exam Ready (Week 18-19)",
      description: "üèÜ GOAL: B2 certification by Dec 12 | 5h daily | Final sprint!",
      grammar: [
        { id: "dec-g1", topic: "Week 1: Komplette B2 Grammatik-Wiederholung", completed: false },
        { id: "dec-g2", topic: "Week 2: Pr√ºfungsrelevante Strukturen + Strategien", completed: false },
        { id: "dec-g3", topic: "Daily: Intensive Fehleranalyse + Korrektur", completed: false },
        { id: "dec-g4", topic: "Daily: Stilverbesserung + Textoptimierung", completed: false },
        { id: "dec-g5", topic: "Final: Pr√ºfungsstrategien + Zeitmanagement", completed: false }
      ],
      vocabulary: [
        { id: "dec-v1", topic: "Week 1: B2 Pr√ºfungswortschatz (100 W√∂rter)", targetWords: 100, learnedWords: 0 },
        { id: "dec-v2", topic: "Week 2: Synonyme & Antonyme (50 W√∂rter)", targetWords: 50, learnedWords: 0 },
        { id: "dec-v3", topic: "Daily: Wiederholung aller gelernten W√∂rter", targetWords: 200, learnedWords: 0 }
      ],
      listening: [
        { id: "dec-l1", goal: "B2 Pr√ºfungssimulationen (komplett)", target: 15, completed: 0 },
        { id: "dec-l2", goal: "Authentische Gespr√§che & Interviews", target: 20, completed: 0 },
        { id: "dec-l3", goal: "Tagesschau & komplexe Nachrichten", target: 12, completed: 0 }
      ],
      writing: [
        { id: "dec-w1", task: "B2 Pr√ºfungsaufs√§tze (t√§glich)", frequency: "t√§glich", completed: 0, target: 12 },
        { id: "dec-w2", task: "Formelle Korrespondenz & Berichte", frequency: "t√§glich", completed: 0, target: 12 },
        { id: "dec-w3", task: "Zeitmanagement-Training", frequency: "t√§glich", completed: 0, target: 12 }
      ],
      speaking: [
        { id: "dec-s1", goal: "M√ºndliche B2 Pr√ºfungssimulation", frequency: "t√§glich", completed: 0, target: 12 },
        { id: "dec-s2", goal: "Freie Gespr√§che & Diskussionen", frequency: "t√§glich", completed: 0, target: 12 },
        { id: "dec-s3", goal: "Pr√ºfungsangst-Management", frequency: "t√§glich", completed: 0, target: 12 }
      ]
    }
  ],
  overallProgress: {
    grammarCompleted: 0,
    grammarTotal: 25,
    vocabularyLearned: 0,
    vocabularyTarget: 1000,
    mockExamsDone: 0,
    mockExamsTarget: 25,
    speakingSessions: 0,
    speakingTarget: 150
  }
});

export const getAyoubDailySchedule = () => ({
  phase1: {
    title: "Phase 1: B1 Mastery (August-October)",
    schedule: {
      "08:00-09:00": "üåÖ Grammatik-Intensiv (Netzwerk B1) + √úbungen",
      "09:00-10:00": "üìö Wortschatz lernen (25-35 neue W√∂rter) + Anki/Flashcards",
      "10:00-10:15": "‚òï Pause",
      "10:15-11:15": "üéß H√∂rverst√§ndnis (Easy German + Deutsche Welle)",
      "11:15-12:15": "‚úçÔ∏è Schreibtraining (E-Mails, Briefe, Tagebuch)",
      "12:15-13:15": "üçΩÔ∏è Mittagspause",
      "13:15-14:15": "üó£Ô∏è Sprechtraining (Selbstgespr√§che + Shadowing)",
      "14:15-15:15": "üìñ Leseverst√§ndnis (Texte B1 Niveau)",
      "15:15-15:30": "‚òï Pause",
      "15:30-16:30": "üîÑ Wiederholung + Hausaufgaben + Fehlerkorrektur"
    }
  },
  phase2: {
    title: "Phase 2: B2 Mastery (November-December)",
    schedule: {
      "08:00-09:00": "üåÖ B2 Grammatik-Intensiv (Netzwerk B2) + komplexe Strukturen",
      "09:00-10:00": "üìö Erweiteter Wortschatz (40+ neue W√∂rter) + Synonyme",
      "10:00-10:15": "‚òï Pause",
      "10:15-11:15": "üéß Komplexes H√∂rverst√§ndnis (Dokumentationen, Nachrichten)",
      "11:15-12:30": "‚úçÔ∏è B2 Schreibtraining (Er√∂rterungen, Berichte, Analysen)",
      "12:30-13:30": "üçΩÔ∏è Mittagspause",
      "13:30-14:30": "üó£Ô∏è Intensives Sprechtraining (Pr√§sentationen, Debatten)",
      "14:30-15:30": "üìñ B2 Leseverst√§ndnis + kritische Textanalyse",
      "15:30-15:45": "‚òï Pause",
      "15:45-16:45": "üéØ Pr√ºfungsvorbereitung + Mock-Tests + Strategien"
    }
  }
});

export const getWeeklyMilestones = () => [
  {
    week: "Week 1-4 (August)",
    goals: [
      "‚úÖ A2 Grammatik komplett wiederholt",
      "‚úÖ 100 neue W√∂rter gelernt (Familie, Arbeit, Gesundheit, Wohnen)",
      "‚úÖ 20 Easy German Videos geschaut",
      "‚úÖ 8 pers√∂nliche E-Mails geschrieben",
      "‚úÖ T√§glich 10 Min Selbstgespr√§che gef√ºhrt"
    ]
  },
  {
    week: "Week 5-8 (September)",
    goals: [
      "‚úÖ B1 Kerngrammatik beherrscht (Konjunktiv II, Passiv, Relativs√§tze)",
      "‚úÖ 120 neue W√∂rter gelernt (Umwelt, Medien, Kultur, Reisen)",
      "‚úÖ Erste B1 Mock-Pr√ºfung bestanden",
      "‚úÖ 8 formelle Briefe geschrieben",
      "‚úÖ 12 strukturierte Gespr√§che gef√ºhrt"
    ]
  },
  {
    week: "Week 9-13 (October)",
    goals: [
      "‚úÖ B1 Zertifikat-bereit (90%+ in Mock-Tests)",
      "‚úÖ 175 neue W√∂rter gelernt (Politik, Wissenschaft, Wirtschaft)",
      "‚úÖ B2 Grammatik begonnen (Nominalisierung, erweiterte Strukturen)",
      "‚úÖ 6 deutsche Filme mit Untertiteln geschaut",
      "‚úÖ 15 B1 Pr√ºfungssimulationen absolviert"
    ]
  },
  {
    week: "Week 14-17 (November)",
    goals: [
      "‚úÖ B2 Kerngrammatik beherrscht",
      "‚úÖ 160 neue W√∂rter gelernt (abstrakte Begriffe, Idiome)",
      "‚úÖ Komplexe Texte verstehen und analysieren",
      "‚úÖ 8 Er√∂rterungen geschrieben (250+ W√∂rter)",
      "‚úÖ 20-Min Pr√§sentationen halten k√∂nnen"
    ]
  },
  {
    week: "Week 18-19 (December 1-12)",
    goals: [
      "üèÜ B2 Pr√ºfung bestehen (Ziel: 12. Dezember)",
      "‚úÖ 150 Pr√ºfungsw√∂rter perfekt beherrscht",
      "‚úÖ 15 komplette B2 Mock-Pr√ºfungen absolviert",
      "‚úÖ Alle 4 Fertigkeiten auf B2-Niveau",
      "‚úÖ Selbstbewusst und pr√ºfungsbereit"
    ]
  }
];

export const updateGrammarProgress = (plan: LearningPlan, monthIndex: number, grammarId: string, completed: boolean): LearningPlan => {
  const updatedPlan = { ...plan };
  const grammar = updatedPlan.months[monthIndex].grammar.find(g => g.id === grammarId);
  if (grammar) {
    const wasCompleted = grammar.completed;
    grammar.completed = completed;
    
    // Update overall progress
    if (completed && !wasCompleted) {
      updatedPlan.overallProgress.grammarCompleted++;
    } else if (!completed && wasCompleted) {
      updatedPlan.overallProgress.grammarCompleted--;
    }
  }
  return updatedPlan;
};

export const updateVocabularyProgress = (plan: LearningPlan, monthIndex: number, vocabId: string, learnedWords: number): LearningPlan => {
  const updatedPlan = { ...plan };
  const vocab = updatedPlan.months[monthIndex].vocabulary.find(v => v.id === vocabId);
  if (vocab) {
    const difference = learnedWords - vocab.learnedWords;
    vocab.learnedWords = learnedWords;
    updatedPlan.overallProgress.vocabularyLearned += difference;
  }
  return updatedPlan;
};

export const updateListeningProgress = (plan: LearningPlan, monthIndex: number, listeningId: string, completed: number): LearningPlan => {
  const updatedPlan = { ...plan };
  const listening = updatedPlan.months[monthIndex].listening.find(l => l.id === listeningId);
  if (listening) {
    listening.completed = completed;
  }
  return updatedPlan;
};

export const updateWritingProgress = (plan: LearningPlan, monthIndex: number, writingId: string, completed: number): LearningPlan => {
  const updatedPlan = { ...plan };
  const writing = updatedPlan.months[monthIndex].writing.find(w => w.id === writingId);
  if (writing) {
    writing.completed = completed;
  }
  return updatedPlan;
};

export const updateSpeakingProgress = (plan: LearningPlan, monthIndex: number, speakingId: string, completed: number): LearningPlan => {
  const updatedPlan = { ...plan };
  const speaking = updatedPlan.months[monthIndex].speaking.find(s => s.id === speakingId);
  if (speaking) {
    const difference = completed - speaking.completed;
    speaking.completed = completed;
    updatedPlan.overallProgress.speakingSessions += difference;
  }
  return updatedPlan;
};

export const calculateMonthProgress = (month: MonthlyPlan): number => {
  const grammarProgress = month.grammar.filter(g => g.completed).length / month.grammar.length;
  const vocabProgress = month.vocabulary.reduce((sum, v) => sum + (v.learnedWords / v.targetWords), 0) / month.vocabulary.length;
  const listeningProgress = month.listening.reduce((sum, l) => sum + (l.completed / l.target), 0) / month.listening.length;
  const writingProgress = month.writing.reduce((sum, w) => sum + (w.completed / w.target), 0) / month.writing.length;
  const speakingProgress = month.speaking.reduce((sum, s) => sum + (s.completed / s.target), 0) / month.speaking.length;
  
  return Math.round(((grammarProgress + vocabProgress + listeningProgress + writingProgress + speakingProgress) / 5) * 100);
};

export const getOverallPlanProgress = (plan: LearningPlan): number => {
  const grammarProgress = plan.overallProgress.grammarCompleted / plan.overallProgress.grammarTotal;
  const vocabProgress = Math.min(plan.overallProgress.vocabularyLearned / plan.overallProgress.vocabularyTarget, 1);
  const mockExamProgress = plan.overallProgress.mockExamsDone / plan.overallProgress.mockExamsTarget;
  const speakingProgress = Math.min(plan.overallProgress.speakingSessions / plan.overallProgress.speakingTarget, 1);
  
  return Math.round(((grammarProgress + vocabProgress + mockExamProgress + speakingProgress) / 4) * 100);
};